#!/bin/sh
# Skip hooks in CI or if SKIP_HOOKS is set
if [ "$CI" = "true" ] || [ "$SKIP_HOOKS" = "1" ]; then
  exit 0
fi

# Explicitly set PATH to include pnpm and node
export PATH="/home/john/.local/share/pnpm:/home/john/.nvm/versions/node/v22.19.0/bin:$PATH"

# Load nvm if available (this will override with correct version)
if [ -f "$HOME/.nvm/nvm.sh" ]; then
  export NVM_DIR="$HOME/.nvm"
  [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
fi

# Check if pnpm is available
if ! command -v pnpm >/dev/null 2>&1; then
  echo "⚠️  Warning: pnpm not found in PATH"
  echo "Current PATH: $PATH"
  echo "Tip: Run 'SKIP_HOOKS=1 git commit' to bypass hooks"
  exit 1
fi

# Run lint-staged for formatting and linting on staged files
echo "Running lint-staged..."
pnpm exec lint-staged || exit 1

# Run TypeScript type checking
echo "Running TypeScript type checking..."
pnpm typecheck || exit 1

# Run tests
echo "Running tests..."
pnpm test || exit 1

