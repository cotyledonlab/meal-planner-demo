{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 45, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/meal-planner-demo/meal-planner-demo/apps/web/src/env.js"],"sourcesContent":["import { createEnv } from '@t3-oss/env-nextjs';\nimport { z } from 'zod';\n\nexport const env = createEnv({\n  /**\n   * Specify your server-side environment variables schema here. This way you can ensure the app\n   * isn't built with invalid env vars.\n   */\n  server: {\n    AUTH_SECRET: process.env.NODE_ENV === 'production' ? z.string() : z.string().optional(),\n    AUTH_DISCORD_ID: z.string().optional(),\n    AUTH_DISCORD_SECRET: z.string().optional(),\n    DATABASE_URL: z.string().url(),\n    NODE_ENV: z.enum(['development', 'test', 'production']).default('development'),\n  },\n\n  /**\n   * Specify your client-side environment variables schema here. This way you can ensure the app\n   * isn't built with invalid env vars. To expose them to the client, prefix them with\n   * `NEXT_PUBLIC_`.\n   */\n  client: {\n    // NEXT_PUBLIC_CLIENTVAR: z.string(),\n  },\n\n  /**\n   * You can't destruct `process.env` as a regular object in the Next.js edge runtimes (e.g.\n   * middlewares) or client-side so we need to destruct manually.\n   */\n  runtimeEnv: {\n    AUTH_SECRET: process.env.AUTH_SECRET,\n    AUTH_DISCORD_ID: process.env.AUTH_DISCORD_ID,\n    AUTH_DISCORD_SECRET: process.env.AUTH_DISCORD_SECRET,\n    DATABASE_URL: process.env.DATABASE_URL,\n    NODE_ENV: process.env.NODE_ENV,\n  },\n  /**\n   * Run `build` or `dev` with `SKIP_ENV_VALIDATION` to skip env validation. This is especially\n   * useful for Docker builds.\n   */\n  skipValidation: !!process.env.SKIP_ENV_VALIDATION,\n  /**\n   * Makes it so that empty strings are treated as undefined. `SOME_VAR: z.string()` and\n   * `SOME_VAR=''` will throw an error.\n   */\n  emptyStringAsUndefined: true,\n});\n\n// Validate that Discord auth credentials are provided together\nif (\n  !process.env.SKIP_ENV_VALIDATION &&\n  ((env.AUTH_DISCORD_ID && !env.AUTH_DISCORD_SECRET) ||\n    (!env.AUTH_DISCORD_ID && env.AUTH_DISCORD_SECRET))\n) {\n  throw new Error(\n    'Invalid Discord auth configuration: set both AUTH_DISCORD_ID and AUTH_DISCORD_SECRET, or remove both.'\n  );\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,MAAM,MAAM,IAAA,qSAAS,EAAC;IAC3B;;;GAGC,GACD,QAAQ;QACN,aAAa,sCAAwC,0BAAa,2NAAC,CAAC,MAAM,GAAG,QAAQ;QACrF,iBAAiB,2NAAC,CAAC,MAAM,GAAG,QAAQ;QACpC,qBAAqB,2NAAC,CAAC,MAAM,GAAG,QAAQ;QACxC,cAAc,2NAAC,CAAC,MAAM,GAAG,GAAG;QAC5B,UAAU,2NAAC,CAAC,IAAI,CAAC;YAAC;YAAe;YAAQ;SAAa,EAAE,OAAO,CAAC;IAClE;IAEA;;;;GAIC,GACD,QAAQ;IAER;IAEA;;;GAGC,GACD,YAAY;QACV,aAAa,QAAQ,GAAG,CAAC,WAAW;QACpC,iBAAiB,QAAQ,GAAG,CAAC,eAAe;QAC5C,qBAAqB,QAAQ,GAAG,CAAC,mBAAmB;QACpD,cAAc,QAAQ,GAAG,CAAC,YAAY;QACtC,QAAQ;IACV;IACA;;;GAGC,GACD,gBAAgB,CAAC,CAAC,QAAQ,GAAG,CAAC,mBAAmB;IACjD;;;GAGC,GACD,wBAAwB;AAC1B;AAEA,+DAA+D;AAC/D,IACE,CAAC,QAAQ,GAAG,CAAC,mBAAmB,IAChC,CAAC,AAAC,IAAI,eAAe,IAAI,CAAC,IAAI,mBAAmB,IAC9C,CAAC,IAAI,eAAe,IAAI,IAAI,mBAAmB,AAAC,GACnD;IACA,MAAM,IAAI,MACR;AAEJ","debugId":null}},
    {"offset": {"line": 158, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/meal-planner-demo/meal-planner-demo/apps/web/src/server/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\nimport { env } from '~/env';\n\nconst createPrismaClient = () =>\n  new PrismaClient({\n    log: env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\n  });\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: ReturnType<typeof createPrismaClient> | undefined;\n};\n\nexport const db = globalForPrisma.prisma ?? createPrismaClient();\n\nif (env.NODE_ENV !== 'production') globalForPrisma.prisma = db;\n"],"names":[],"mappings":";;;;AAAA;AAEA;;;AAEA,MAAM,qBAAqB,IACzB,IAAI,6IAAY,CAAC;QACf,KAAK,kIAAG,CAAC,QAAQ,KAAK,gBAAgB;YAAC;YAAS;YAAS;SAAO,GAAG;YAAC;SAAQ;IAC9E;AAEF,MAAM,kBAAkB;AAIjB,MAAM,KAAK,gBAAgB,MAAM,IAAI;AAE5C,IAAI,kIAAG,CAAC,QAAQ,KAAK,cAAc,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 182, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/meal-planner-demo/meal-planner-demo/apps/web/src/server/auth/config.ts"],"sourcesContent":["import { PrismaAdapter } from '@auth/prisma-adapter';\nimport { type DefaultSession, type NextAuthConfig } from 'next-auth';\nimport CredentialsProvider from 'next-auth/providers/credentials';\nimport DiscordProvider from 'next-auth/providers/discord';\nimport { verify } from '@node-rs/argon2';\nimport { z } from 'zod';\n\nimport { db } from '~/server/db';\n\nconst signInSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(1),\n});\n\n/**\n * Module augmentation for `next-auth` types. Allows us to add custom properties to the `session`\n * object and keep type safety.\n *\n * @see https://next-auth.js.org/getting-started/typescript#module-augmentation\n */\ndeclare module 'next-auth' {\n  interface Session extends DefaultSession {\n    user: {\n      id: string;\n      // ...other properties\n      // role: UserRole;\n    } & DefaultSession['user'];\n  }\n\n  // interface User {\n  //   // ...other properties\n  //   // role: UserRole;\n  // }\n}\n\n/**\n * Options for NextAuth.js used to configure adapters, providers, callbacks, etc.\n *\n * @see https://next-auth.js.org/configuration/options\n */\nexport const authConfig = {\n  providers: [\n    CredentialsProvider({\n      name: 'Email & Password',\n      credentials: {\n        email: { label: 'Email', type: 'email' },\n        password: { label: 'Password', type: 'password' },\n      },\n      async authorize(credentials) {\n        const parsed = signInSchema.safeParse(credentials);\n        if (!parsed.success) {\n          return null;\n        }\n\n        const { email, password } = parsed.data;\n\n        const user = await db.user.findUnique({\n          where: { email },\n          include: { password: true },\n        });\n\n        if (!user?.password?.hash) {\n          return null;\n        }\n\n        const isValid = await verify(user.password.hash, password, {\n          memoryCost: 19456,\n          timeCost: 2,\n          outputLen: 32,\n          parallelism: 1,\n        });\n\n        if (!isValid) {\n          return null;\n        }\n\n        return {\n          id: user.id,\n          email: user.email,\n          name: user.name,\n          image: user.image,\n        };\n      },\n    }),\n    DiscordProvider,\n    /**\n     * ...add more providers here.\n     *\n     * Most other providers require a bit more work than the Discord provider. For example, the\n     * GitHub provider requires you to add the `refresh_token_expires_in` field to the Account\n     * model. Refer to the NextAuth.js docs for the provider you want to use. Example:\n     *\n     * @see https://next-auth.js.org/providers/github\n     */\n  ],\n  adapter: PrismaAdapter(db),\n  session: {\n    strategy: 'jwt',\n  },\n  pages: {\n    signIn: '/auth/signin',\n  },\n  callbacks: {\n    jwt: ({ token, user }) => {\n      if (user) {\n        token.id = user.id;\n      }\n      return token;\n    },\n    session: ({ session, token }) => ({\n      ...session,\n      user: {\n        ...session.user,\n        id: token.id as string,\n      },\n    }),\n  },\n} satisfies NextAuthConfig;\n"],"names":[],"mappings":";;;;AAAA;AAEA;AAAA;AACA;AAAA;AACA;AACA;AAEA;;;;;;;AAEA,MAAM,eAAe,2NAAC,CAAC,MAAM,CAAC;IAC5B,OAAO,2NAAC,CAAC,MAAM,GAAG,KAAK;IACvB,UAAU,2NAAC,CAAC,MAAM,GAAG,GAAG,CAAC;AAC3B;AA4BO,MAAM,aAAa;IACxB,WAAW;QACT,IAAA,mOAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAQ;gBACvC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW;gBACzB,MAAM,SAAS,aAAa,SAAS,CAAC;gBACtC,IAAI,CAAC,OAAO,OAAO,EAAE;oBACnB,OAAO;gBACT;gBAEA,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,OAAO,IAAI;gBAEvC,MAAM,OAAO,MAAM,0IAAE,CAAC,IAAI,CAAC,UAAU,CAAC;oBACpC,OAAO;wBAAE;oBAAM;oBACf,SAAS;wBAAE,UAAU;oBAAK;gBAC5B;gBAEA,IAAI,CAAC,MAAM,UAAU,MAAM;oBACzB,OAAO;gBACT;gBAEA,MAAM,UAAU,MAAM,IAAA,+IAAM,EAAC,KAAK,QAAQ,CAAC,IAAI,EAAE,UAAU;oBACzD,YAAY;oBACZ,UAAU;oBACV,WAAW;oBACX,aAAa;gBACf;gBAEA,IAAI,CAAC,SAAS;oBACZ,OAAO;gBACT;gBAEA,OAAO;oBACL,IAAI,KAAK,EAAE;oBACX,OAAO,KAAK,KAAK;oBACjB,MAAM,KAAK,IAAI;oBACf,OAAO,KAAK,KAAK;gBACnB;YACF;QACF;QACA,+NAAe;KAUhB;IACD,SAAS,IAAA,6XAAa,EAAC,0IAAE;IACzB,SAAS;QACP,UAAU;IACZ;IACA,OAAO;QACL,QAAQ;IACV;IACA,WAAW;QACT,KAAK,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE;YACnB,IAAI,MAAM;gBACR,MAAM,EAAE,GAAG,KAAK,EAAE;YACpB;YACA,OAAO;QACT;QACA,SAAS,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,GAAK,CAAC;gBAChC,GAAG,OAAO;gBACV,MAAM;oBACJ,GAAG,QAAQ,IAAI;oBACf,IAAI,MAAM,EAAE;gBACd;YACF,CAAC;IACH;AACF","debugId":null}},
    {"offset": {"line": 281, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/meal-planner-demo/meal-planner-demo/apps/web/src/server/auth/index.ts"],"sourcesContent":["import NextAuth from 'next-auth';\nimport { cache } from 'react';\n\nimport { authConfig } from './config';\n\nconst { auth: uncachedAuth, handlers, signIn, signOut } = NextAuth(authConfig);\n\nconst auth = cache(uncachedAuth);\n\nexport { auth, handlers, signIn, signOut };\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AAEA;;;;AAEA,MAAM,EAAE,MAAM,YAAY,EAAE,QAAQ,EAAE,MAAM,EAAE,OAAO,EAAE,GAAG,IAAA,uYAAQ,EAAC,8JAAU;AAE7E,MAAM,OAAO,IAAA,iXAAK,EAAC","debugId":null}},
    {"offset": {"line": 304, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/meal-planner-demo/meal-planner-demo/apps/web/src/server/api/trpc.ts"],"sourcesContent":["/**\n * YOU PROBABLY DON'T NEED TO EDIT THIS FILE, UNLESS:\n * 1. You want to modify request context (see Part 1).\n * 2. You want to create a new middleware or type of procedure (see Part 3).\n *\n * TL;DR - This is where all the tRPC server stuff is created and plugged in. The pieces you will\n * need to use are documented accordingly near the end.\n */\n\nimport { initTRPC, TRPCError } from '@trpc/server';\nimport superjson from 'superjson';\nimport { ZodError } from 'zod';\n\nimport { auth } from '~/server/auth';\nimport { db } from '~/server/db';\n\n/**\n * 1. CONTEXT\n *\n * This section defines the \"contexts\" that are available in the backend API.\n *\n * These allow you to access things when processing a request, like the database, the session, etc.\n *\n * This helper generates the \"internals\" for a tRPC context. The API handler and RSC clients each\n * wrap this and provides the required context.\n *\n * @see https://trpc.io/docs/server/context\n */\nexport const createTRPCContext = async (opts: { headers: Headers }) => {\n  const session = await auth();\n\n  return {\n    db,\n    session,\n    ...opts,\n  };\n};\n\n/**\n * 2. INITIALIZATION\n *\n * This is where the tRPC API is initialized, connecting the context and transformer. We also parse\n * ZodErrors so that you get typesafety on the frontend if your procedure fails due to validation\n * errors on the backend.\n */\nconst t = initTRPC.context<typeof createTRPCContext>().create({\n  transformer: superjson,\n  errorFormatter({ shape, error }) {\n    return {\n      ...shape,\n      data: {\n        ...shape.data,\n        zodError: error.cause instanceof ZodError ? error.cause.flatten() : null,\n      },\n    };\n  },\n});\n\n/**\n * Create a server-side caller.\n *\n * @see https://trpc.io/docs/server/server-side-calls\n */\nexport const createCallerFactory = t.createCallerFactory;\n\n/**\n * 3. ROUTER & PROCEDURE (THE IMPORTANT BIT)\n *\n * These are the pieces you use to build your tRPC API. You should import these a lot in the\n * \"/src/server/api/routers\" directory.\n */\n\n/**\n * This is how you create new routers and sub-routers in your tRPC API.\n *\n * @see https://trpc.io/docs/router\n */\nexport const createTRPCRouter = t.router;\n\n/**\n * Middleware for timing procedure execution and adding an artificial delay in development.\n *\n * You can remove this if you don't like it, but it can help catch unwanted waterfalls by simulating\n * network latency that would occur in production but not in local development.\n */\nconst timingMiddleware = t.middleware(async ({ next, path }) => {\n  const start = Date.now();\n\n  if (t._config.isDev) {\n    // artificial delay in dev\n    const waitMs = Math.floor(Math.random() * 400) + 100;\n    await new Promise((resolve) => setTimeout(resolve, waitMs));\n  }\n\n  const result = await next();\n\n  const end = Date.now();\n  console.log(`[TRPC] ${path} took ${end - start}ms to execute`);\n\n  return result;\n});\n\n/**\n * Public (unauthenticated) procedure\n *\n * This is the base piece you use to build new queries and mutations on your tRPC API. It does not\n * guarantee that a user querying is authorized, but you can still access user session data if they\n * are logged in.\n */\nexport const publicProcedure = t.procedure.use(timingMiddleware);\n\n/**\n * Protected (authenticated) procedure\n *\n * If you want a query or mutation to ONLY be accessible to logged in users, use this. It verifies\n * the session is valid and guarantees `ctx.session.user` is not null.\n *\n * @see https://trpc.io/docs/procedures\n */\nexport const protectedProcedure = t.procedure.use(timingMiddleware).use(({ ctx, next }) => {\n  if (!ctx.session?.user) {\n    throw new TRPCError({ code: 'UNAUTHORIZED' });\n  }\n  return next({\n    ctx: {\n      // infers the `session` as non-nullable\n      session: { ...ctx.session, user: ctx.session.user },\n    },\n  });\n});\n"],"names":[],"mappings":"AAAA;;;;;;;CAOC;;;;;;;;;;;;AAED;AAAA;AACA;AACA;AAEA;AACA;;;;;;AAcO,MAAM,oBAAoB,OAAO;IACtC,MAAM,UAAU,MAAM,IAAA,uJAAI;IAE1B,OAAO;QACL,IAAA,0IAAE;QACF;QACA,GAAG,IAAI;IACT;AACF;AAEA;;;;;;CAMC,GACD,MAAM,IAAI,uQAAQ,CAAC,OAAO,GAA6B,MAAM,CAAC;IAC5D,aAAa,6MAAS;IACtB,gBAAe,EAAE,KAAK,EAAE,KAAK,EAAE;QAC7B,OAAO;YACL,GAAG,KAAK;YACR,MAAM;gBACJ,GAAG,MAAM,IAAI;gBACb,UAAU,MAAM,KAAK,YAAY,qMAAQ,GAAG,MAAM,KAAK,CAAC,OAAO,KAAK;YACtE;QACF;IACF;AACF;AAOO,MAAM,sBAAsB,EAAE,mBAAmB;AAcjD,MAAM,mBAAmB,EAAE,MAAM;AAExC;;;;;CAKC,GACD,MAAM,mBAAmB,EAAE,UAAU,CAAC,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE;IACzD,MAAM,QAAQ,KAAK,GAAG;IAEtB,IAAI,EAAE,OAAO,CAAC,KAAK,EAAE;QACnB,0BAA0B;QAC1B,MAAM,SAAS,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,OAAO;QACjD,MAAM,IAAI,QAAQ,CAAC,UAAY,WAAW,SAAS;IACrD;IAEA,MAAM,SAAS,MAAM;IAErB,MAAM,MAAM,KAAK,GAAG;IACpB,QAAQ,GAAG,CAAC,CAAC,OAAO,EAAE,KAAK,MAAM,EAAE,MAAM,MAAM,aAAa,CAAC;IAE7D,OAAO;AACT;AASO,MAAM,kBAAkB,EAAE,SAAS,CAAC,GAAG,CAAC;AAUxC,MAAM,qBAAqB,EAAE,SAAS,CAAC,GAAG,CAAC,kBAAkB,GAAG,CAAC,CAAC,EAAE,GAAG,EAAE,IAAI,EAAE;IACpF,IAAI,CAAC,IAAI,OAAO,EAAE,MAAM;QACtB,MAAM,IAAI,uQAAS,CAAC;YAAE,MAAM;QAAe;IAC7C;IACA,OAAO,KAAK;QACV,KAAK;YACH,uCAAuC;YACvC,SAAS;gBAAE,GAAG,IAAI,OAAO;gBAAE,MAAM,IAAI,OAAO,CAAC,IAAI;YAAC;QACpD;IACF;AACF","debugId":null}},
    {"offset": {"line": 400, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/meal-planner-demo/meal-planner-demo/apps/web/src/server/api/routers/post.ts"],"sourcesContent":["import { z } from 'zod';\n\nimport { createTRPCRouter, protectedProcedure, publicProcedure } from '~/server/api/trpc';\n\nexport const postRouter = createTRPCRouter({\n  hello: publicProcedure.input(z.object({ text: z.string() })).query(({ input }) => {\n    return {\n      greeting: `Hello ${input.text}`,\n    };\n  }),\n\n  create: protectedProcedure\n    .input(z.object({ name: z.string().min(1) }))\n    .mutation(async ({ ctx, input }) => {\n      return ctx.db.post.create({\n        data: {\n          name: input.name,\n          createdBy: { connect: { id: ctx.session.user.id } },\n        },\n      });\n    }),\n\n  getLatest: protectedProcedure.query(async ({ ctx }) => {\n    const post = await ctx.db.post.findFirst({\n      orderBy: { createdAt: 'desc' },\n      where: { createdBy: { id: ctx.session.user.id } },\n    });\n\n    return post ?? null;\n  }),\n\n  getSecretMessage: protectedProcedure.query(() => {\n    return 'you can now see this secret message!';\n  }),\n});\n"],"names":[],"mappings":";;;;AAAA;AAEA;;;AAEO,MAAM,aAAa,IAAA,iKAAgB,EAAC;IACzC,OAAO,gKAAe,CAAC,KAAK,CAAC,2NAAC,CAAC,MAAM,CAAC;QAAE,MAAM,2NAAC,CAAC,MAAM;IAAG,IAAI,KAAK,CAAC,CAAC,EAAE,KAAK,EAAE;QAC3E,OAAO;YACL,UAAU,CAAC,MAAM,EAAE,MAAM,IAAI,EAAE;QACjC;IACF;IAEA,QAAQ,mKAAkB,CACvB,KAAK,CAAC,2NAAC,CAAC,MAAM,CAAC;QAAE,MAAM,2NAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAAG,IACzC,QAAQ,CAAC,OAAO,EAAE,GAAG,EAAE,KAAK,EAAE;QAC7B,OAAO,IAAI,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC;YACxB,MAAM;gBACJ,MAAM,MAAM,IAAI;gBAChB,WAAW;oBAAE,SAAS;wBAAE,IAAI,IAAI,OAAO,CAAC,IAAI,CAAC,EAAE;oBAAC;gBAAE;YACpD;QACF;IACF;IAEF,WAAW,mKAAkB,CAAC,KAAK,CAAC,OAAO,EAAE,GAAG,EAAE;QAChD,MAAM,OAAO,MAAM,IAAI,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC;YACvC,SAAS;gBAAE,WAAW;YAAO;YAC7B,OAAO;gBAAE,WAAW;oBAAE,IAAI,IAAI,OAAO,CAAC,IAAI,CAAC,EAAE;gBAAC;YAAE;QAClD;QAEA,OAAO,QAAQ;IACjB;IAEA,kBAAkB,mKAAkB,CAAC,KAAK,CAAC;QACzC,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 451, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/meal-planner-demo/meal-planner-demo/apps/web/src/server/api/routers/preferences.ts"],"sourcesContent":["import { z } from 'zod';\nimport { createTRPCRouter, protectedProcedure } from '~/server/api/trpc';\n\nexport const preferencesRouter = createTRPCRouter({\n  // Get user preferences\n  get: protectedProcedure.query(async ({ ctx }) => {\n    const preferences = await ctx.db.userPreferences.findUnique({\n      where: { userId: ctx.session.user.id },\n    });\n\n    // Return default preferences if none exist\n    if (!preferences) {\n      return {\n        householdSize: 2,\n        mealsPerDay: 1,\n        days: 7,\n        isVegetarian: false,\n        isDairyFree: false,\n        dislikes: '',\n      };\n    }\n\n    return preferences;\n  }),\n\n  // Update user preferences\n  update: protectedProcedure\n    .input(\n      z.object({\n        householdSize: z.number().min(1).max(10),\n        mealsPerDay: z.number().min(1).max(3),\n        days: z.number().min(3).max(7),\n        isVegetarian: z.boolean(),\n        isDairyFree: z.boolean(),\n        dislikes: z.string().optional(),\n      })\n    )\n    .mutation(async ({ ctx, input }) => {\n      const preferences = await ctx.db.userPreferences.upsert({\n        where: { userId: ctx.session.user.id },\n        create: {\n          userId: ctx.session.user.id,\n          ...input,\n        },\n        update: input,\n      });\n\n      return preferences;\n    }),\n});\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,MAAM,oBAAoB,IAAA,iKAAgB,EAAC;IAChD,uBAAuB;IACvB,KAAK,mKAAkB,CAAC,KAAK,CAAC,OAAO,EAAE,GAAG,EAAE;QAC1C,MAAM,cAAc,MAAM,IAAI,EAAE,CAAC,eAAe,CAAC,UAAU,CAAC;YAC1D,OAAO;gBAAE,QAAQ,IAAI,OAAO,CAAC,IAAI,CAAC,EAAE;YAAC;QACvC;QAEA,2CAA2C;QAC3C,IAAI,CAAC,aAAa;YAChB,OAAO;gBACL,eAAe;gBACf,aAAa;gBACb,MAAM;gBACN,cAAc;gBACd,aAAa;gBACb,UAAU;YACZ;QACF;QAEA,OAAO;IACT;IAEA,0BAA0B;IAC1B,QAAQ,mKAAkB,CACvB,KAAK,CACJ,2NAAC,CAAC,MAAM,CAAC;QACP,eAAe,2NAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC;QACrC,aAAa,2NAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC;QACnC,MAAM,2NAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC;QAC5B,cAAc,2NAAC,CAAC,OAAO;QACvB,aAAa,2NAAC,CAAC,OAAO;QACtB,UAAU,2NAAC,CAAC,MAAM,GAAG,QAAQ;IAC/B,IAED,QAAQ,CAAC,OAAO,EAAE,GAAG,EAAE,KAAK,EAAE;QAC7B,MAAM,cAAc,MAAM,IAAI,EAAE,CAAC,eAAe,CAAC,MAAM,CAAC;YACtD,OAAO;gBAAE,QAAQ,IAAI,OAAO,CAAC,IAAI,CAAC,EAAE;YAAC;YACrC,QAAQ;gBACN,QAAQ,IAAI,OAAO,CAAC,IAAI,CAAC,EAAE;gBAC3B,GAAG,KAAK;YACV;YACA,QAAQ;QACV;QAEA,OAAO;IACT;AACJ","debugId":null}},
    {"offset": {"line": 506, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/meal-planner-demo/meal-planner-demo/apps/web/src/server/api/routers/mealPlan.ts"],"sourcesContent":["import { z } from 'zod';\nimport { createTRPCRouter, protectedProcedure } from '~/server/api/trpc';\nimport type { Recipe, PrismaClient } from '@prisma/client';\n\n/**\n * Rule-based meal plan generator\n * Filters recipes based on user preferences and creates a balanced plan\n */\nasync function generateMealPlan(\n  ctx: { db: PrismaClient },\n  preferences: {\n    householdSize: number;\n    mealsPerDay: number;\n    days: number;\n    isVegetarian: boolean;\n    isDairyFree: boolean;\n    dislikes: string | null;\n  }\n) {\n  const dislikeList = preferences.dislikes\n    ? preferences.dislikes.split(',').map((d) => d.trim().toLowerCase())\n    : [];\n\n  // Fetch recipes that match dietary preferences\n  const allRecipes = await ctx.db.recipe.findMany({\n    where: {\n      AND: [\n        preferences.isVegetarian ? { isVegetarian: true } : {},\n        preferences.isDairyFree ? { isDairyFree: true } : {},\n      ],\n    },\n    include: {\n      ingredients: {\n        include: {\n          ingredient: true,\n        },\n      },\n    },\n  });\n\n  // Filter out recipes with disliked ingredients\n  const filteredRecipes = allRecipes.filter((recipe) => {\n    if (dislikeList.length === 0) return true;\n    \n    const recipeIngredients = recipe.ingredients.map((ri) =>\n      ri.ingredient.name.toLowerCase()\n    );\n    \n    return !dislikeList.some((dislike) =>\n      recipeIngredients.some((ing) => ing.includes(dislike))\n    );\n  });\n\n  if (filteredRecipes.length === 0) {\n    throw new Error('No recipes match your preferences. Please adjust your settings.');\n  }\n\n  // Generate meal plan items\n  const selectedRecipes: Array<{\n    recipe: Recipe;\n    dayIndex: number;\n    mealType: string;\n  }> = [];\n\n  // Simple round-robin selection to ensure variety\n  let recipeIndex = 0;\n  for (let day = 0; day < preferences.days; day++) {\n    for (let meal = 0; meal < preferences.mealsPerDay; meal++) {\n      const recipe = filteredRecipes[recipeIndex % filteredRecipes.length];\n      if (!recipe) continue;\n\n      // Determine meal type\n      let mealType = 'dinner';\n      if (preferences.mealsPerDay === 2) {\n        mealType = meal === 0 ? 'lunch' : 'dinner';\n      } else if (preferences.mealsPerDay === 3) {\n        mealType = meal === 0 ? 'breakfast' : meal === 1 ? 'lunch' : 'dinner';\n      }\n\n      selectedRecipes.push({\n        recipe,\n        dayIndex: day,\n        mealType,\n      });\n\n      recipeIndex++;\n    }\n  }\n\n  return selectedRecipes;\n}\n\nexport const mealPlanRouter = createTRPCRouter({\n  // Get current or latest meal plan for user\n  getCurrent: protectedProcedure.query(async ({ ctx }) => {\n    const latestPlan = await ctx.db.mealPlan.findFirst({\n      where: { userId: ctx.session.user.id },\n      orderBy: { createdAt: 'desc' },\n      include: {\n        items: {\n          include: {\n            recipe: {\n              include: {\n                ingredients: {\n                  include: {\n                    ingredient: true,\n                  },\n                },\n              },\n            },\n          },\n          orderBy: [{ dayIndex: 'asc' }, { mealType: 'asc' }],\n        },\n      },\n    });\n\n    return latestPlan;\n  }),\n\n  // Generate a new meal plan\n  generate: protectedProcedure\n    .input(\n      z.object({\n        householdSize: z.number().min(1).max(10).optional(),\n        mealsPerDay: z.number().min(1).max(3).optional(),\n        days: z.number().min(3).max(7).optional(),\n        isVegetarian: z.boolean().optional(),\n        isDairyFree: z.boolean().optional(),\n        dislikes: z.string().optional(),\n      })\n    )\n    .mutation(async ({ ctx, input }) => {\n      // Get user preferences or use input\n      let preferences = await ctx.db.userPreferences.findUnique({\n        where: { userId: ctx.session.user.id },\n      });\n\n      // If no preferences exist, create them from input or defaults\n      if (!preferences) {\n        preferences = await ctx.db.userPreferences.create({\n          data: {\n            userId: ctx.session.user.id,\n            householdSize: input.householdSize ?? 2,\n            mealsPerDay: input.mealsPerDay ?? 1,\n            days: input.days ?? 7,\n            isVegetarian: input.isVegetarian ?? false,\n            isDairyFree: input.isDairyFree ?? false,\n            dislikes: input.dislikes ?? '',\n          },\n        });\n      } else if (Object.keys(input).length > 0) {\n        // Update preferences if input provided\n        preferences = await ctx.db.userPreferences.update({\n          where: { userId: ctx.session.user.id },\n          data: {\n            ...input,\n          },\n        });\n      }\n\n      // Generate meal plan\n      const selectedRecipes = await generateMealPlan(ctx, preferences);\n\n      // Create meal plan in database\n      const mealPlan = await ctx.db.mealPlan.create({\n        data: {\n          userId: ctx.session.user.id,\n          startDate: new Date(),\n          days: preferences.days,\n          items: {\n            create: selectedRecipes.map((item) => ({\n              dayIndex: item.dayIndex,\n              mealType: item.mealType,\n              recipeId: item.recipe.id,\n              servings: preferences.householdSize,\n            })),\n          },\n        },\n        include: {\n          items: {\n            include: {\n              recipe: {\n                include: {\n                  ingredients: {\n                    include: {\n                      ingredient: true,\n                    },\n                  },\n                },\n              },\n            },\n            orderBy: [{ dayIndex: 'asc' }, { mealType: 'asc' }],\n          },\n        },\n      });\n\n      return mealPlan;\n    }),\n\n  // Delete a meal plan\n  delete: protectedProcedure\n    .input(z.object({ id: z.string() }))\n    .mutation(async ({ ctx, input }) => {\n      // Verify ownership\n      const plan = await ctx.db.mealPlan.findUnique({\n        where: { id: input.id },\n      });\n\n      if (!plan || plan.userId !== ctx.session.user.id) {\n        throw new Error('Meal plan not found or access denied');\n      }\n\n      await ctx.db.mealPlan.delete({\n        where: { id: input.id },\n      });\n\n      return { success: true };\n    }),\n});\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 718, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/meal-planner-demo/meal-planner-demo/apps/web/src/lib/unitConverter.ts"],"sourcesContent":["/**\n * Unit converter utilities for recipe measurements\n * Converts common cooking measurements to normalized units (g, ml, pcs)\n */\n\nexport type NormalizedUnit = 'g' | 'ml' | 'pcs';\n\ninterface ConversionRule {\n  toUnit: NormalizedUnit;\n  multiplier: number;\n}\n\nconst conversionRules: Record<string, ConversionRule> = {\n  // Weight conversions to grams\n  'g': { toUnit: 'g', multiplier: 1 },\n  'kg': { toUnit: 'g', multiplier: 1000 },\n  'oz': { toUnit: 'g', multiplier: 28.35 },\n  'lb': { toUnit: 'g', multiplier: 453.592 },\n  \n  // Volume conversions to milliliters\n  'ml': { toUnit: 'ml', multiplier: 1 },\n  'l': { toUnit: 'ml', multiplier: 1000 },\n  'tsp': { toUnit: 'ml', multiplier: 5 },\n  'tbsp': { toUnit: 'ml', multiplier: 15 },\n  'cup': { toUnit: 'ml', multiplier: 240 },\n  'fl oz': { toUnit: 'ml', multiplier: 29.5735 },\n  \n  // Pieces/count (no conversion)\n  'pcs': { toUnit: 'pcs', multiplier: 1 },\n  'pieces': { toUnit: 'pcs', multiplier: 1 },\n  'count': { toUnit: 'pcs', multiplier: 1 },\n  'whole': { toUnit: 'pcs', multiplier: 1 },\n};\n\n/**\n * Convert a quantity and unit to normalized units\n * @param quantity The amount\n * @param unit The unit to convert from\n * @returns Object with normalized quantity and unit\n */\nexport function convertToNormalizedUnit(\n  quantity: number,\n  unit: string\n): { quantity: number; unit: NormalizedUnit } {\n  const normalizedInputUnit = unit.toLowerCase().trim();\n  const rule = conversionRules[normalizedInputUnit];\n  \n  if (!rule) {\n    throw new Error(`Unknown unit: ${unit}. Cannot convert to normalized unit.`);\n  }\n  \n  return {\n    quantity: quantity * rule.multiplier,\n    unit: rule.toUnit,\n  };\n}\n\n/**\n * Aggregate ingredients by combining quantities in the same unit\n * @param ingredients Array of ingredients with quantities and units\n * @returns Map of ingredient ID to aggregated quantity and unit\n */\nexport function aggregateIngredients(\n  ingredients: Array<{ ingredientId: string; quantity: number; unit: string }>\n): Map<string, { quantity: number; unit: NormalizedUnit }> {\n  const aggregated = new Map<string, { quantity: number; unit: NormalizedUnit }>();\n  \n  for (const ing of ingredients) {\n    const normalized = convertToNormalizedUnit(ing.quantity, ing.unit);\n    const existing = aggregated.get(ing.ingredientId);\n    \n    if (existing) {\n      if (existing.unit !== normalized.unit) {\n        throw new Error(\n          `Cannot aggregate ingredients with different unit types: ${existing.unit} vs ${normalized.unit}`\n        );\n      }\n      existing.quantity += normalized.quantity;\n    } else {\n      aggregated.set(ing.ingredientId, { ...normalized });\n    }\n  }\n  \n  return aggregated;\n}\n\n/**\n * Format a quantity and unit for display\n * @param quantity The amount\n * @param unit The unit\n * @returns Formatted string (e.g., \"500g\", \"250ml\", \"2 pcs\")\n */\nexport function formatQuantity(quantity: number, unit: NormalizedUnit): string {\n  const rounded = Math.round(quantity * 10) / 10; // Round to 1 decimal place\n  \n  if (unit === 'pcs') {\n    return `${Math.round(quantity)} pcs`;\n  }\n  \n  // Convert large quantities to larger units for readability\n  if (unit === 'g' && quantity >= 1000) {\n    return `${(rounded / 1000).toFixed(1)}kg`;\n  }\n  \n  if (unit === 'ml' && quantity >= 1000) {\n    return `${(rounded / 1000).toFixed(1)}L`;\n  }\n  \n  return `${rounded}${unit}`;\n}\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;AASD,MAAM,kBAAkD;IACtD,8BAA8B;IAC9B,KAAK;QAAE,QAAQ;QAAK,YAAY;IAAE;IAClC,MAAM;QAAE,QAAQ;QAAK,YAAY;IAAK;IACtC,MAAM;QAAE,QAAQ;QAAK,YAAY;IAAM;IACvC,MAAM;QAAE,QAAQ;QAAK,YAAY;IAAQ;IAEzC,oCAAoC;IACpC,MAAM;QAAE,QAAQ;QAAM,YAAY;IAAE;IACpC,KAAK;QAAE,QAAQ;QAAM,YAAY;IAAK;IACtC,OAAO;QAAE,QAAQ;QAAM,YAAY;IAAE;IACrC,QAAQ;QAAE,QAAQ;QAAM,YAAY;IAAG;IACvC,OAAO;QAAE,QAAQ;QAAM,YAAY;IAAI;IACvC,SAAS;QAAE,QAAQ;QAAM,YAAY;IAAQ;IAE7C,+BAA+B;IAC/B,OAAO;QAAE,QAAQ;QAAO,YAAY;IAAE;IACtC,UAAU;QAAE,QAAQ;QAAO,YAAY;IAAE;IACzC,SAAS;QAAE,QAAQ;QAAO,YAAY;IAAE;IACxC,SAAS;QAAE,QAAQ;QAAO,YAAY;IAAE;AAC1C;AAQO,SAAS,wBACd,QAAgB,EAChB,IAAY;IAEZ,MAAM,sBAAsB,KAAK,WAAW,GAAG,IAAI;IACnD,MAAM,OAAO,eAAe,CAAC,oBAAoB;IAEjD,IAAI,CAAC,MAAM;QACT,MAAM,IAAI,MAAM,CAAC,cAAc,EAAE,KAAK,oCAAoC,CAAC;IAC7E;IAEA,OAAO;QACL,UAAU,WAAW,KAAK,UAAU;QACpC,MAAM,KAAK,MAAM;IACnB;AACF;AAOO,SAAS,qBACd,WAA4E;IAE5E,MAAM,aAAa,IAAI;IAEvB,KAAK,MAAM,OAAO,YAAa;QAC7B,MAAM,aAAa,wBAAwB,IAAI,QAAQ,EAAE,IAAI,IAAI;QACjE,MAAM,WAAW,WAAW,GAAG,CAAC,IAAI,YAAY;QAEhD,IAAI,UAAU;YACZ,IAAI,SAAS,IAAI,KAAK,WAAW,IAAI,EAAE;gBACrC,MAAM,IAAI,MACR,CAAC,wDAAwD,EAAE,SAAS,IAAI,CAAC,IAAI,EAAE,WAAW,IAAI,EAAE;YAEpG;YACA,SAAS,QAAQ,IAAI,WAAW,QAAQ;QAC1C,OAAO;YACL,WAAW,GAAG,CAAC,IAAI,YAAY,EAAE;gBAAE,GAAG,UAAU;YAAC;QACnD;IACF;IAEA,OAAO;AACT;AAQO,SAAS,eAAe,QAAgB,EAAE,IAAoB;IACnE,MAAM,UAAU,KAAK,KAAK,CAAC,WAAW,MAAM,IAAI,2BAA2B;IAE3E,IAAI,SAAS,OAAO;QAClB,OAAO,GAAG,KAAK,KAAK,CAAC,UAAU,IAAI,CAAC;IACtC;IAEA,2DAA2D;IAC3D,IAAI,SAAS,OAAO,YAAY,MAAM;QACpC,OAAO,GAAG,CAAC,UAAU,IAAI,EAAE,OAAO,CAAC,GAAG,EAAE,CAAC;IAC3C;IAEA,IAAI,SAAS,QAAQ,YAAY,MAAM;QACrC,OAAO,GAAG,CAAC,UAAU,IAAI,EAAE,OAAO,CAAC,GAAG,CAAC,CAAC;IAC1C;IAEA,OAAO,GAAG,UAAU,MAAM;AAC5B","debugId":null}},
    {"offset": {"line": 837, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/meal-planner-demo/meal-planner-demo/apps/web/src/server/api/routers/shoppingList.ts"],"sourcesContent":["import { z } from 'zod';\nimport { createTRPCRouter, protectedProcedure } from '~/server/api/trpc';\nimport { aggregateIngredients, formatQuantity } from '~/lib/unitConverter';\nimport type { NormalizedUnit } from '~/lib/unitConverter';\n\ninterface ShoppingListItem {\n  ingredientId: string;\n  ingredientName: string;\n  category: string;\n  quantity: number;\n  unit: NormalizedUnit;\n  formattedQuantity: string;\n}\n\ninterface StorePrice {\n  store: string;\n  totalPrice: number;\n}\n\nexport const shoppingListRouter = createTRPCRouter({\n  // Generate shopping list for a meal plan\n  getForMealPlan: protectedProcedure\n    .input(z.object({ mealPlanId: z.string() }))\n    .query(async ({ ctx, input }) => {\n      // Verify ownership and get meal plan with all recipes\n      const mealPlan = await ctx.db.mealPlan.findUnique({\n        where: { id: input.mealPlanId },\n        include: {\n          items: {\n            include: {\n              recipe: {\n                include: {\n                  ingredients: {\n                    include: {\n                      ingredient: true,\n                    },\n                  },\n                },\n              },\n            },\n          },\n        },\n      });\n\n      if (!mealPlan || mealPlan.userId !== ctx.session.user.id) {\n        throw new Error('Meal plan not found or access denied');\n      }\n\n      // Collect all ingredients from all recipes, scaled by servings\n      const allIngredients: Array<{\n        ingredientId: string;\n        quantity: number;\n        unit: string;\n      }> = [];\n\n      for (const item of mealPlan.items) {\n        const servingMultiplier = item.servings / item.recipe.servingsDefault;\n\n        for (const recipeIng of item.recipe.ingredients) {\n          allIngredients.push({\n            ingredientId: recipeIng.ingredientId,\n            quantity: recipeIng.quantity * servingMultiplier,\n            unit: recipeIng.unit,\n          });\n        }\n      }\n\n      // Aggregate ingredients\n      const aggregated = aggregateIngredients(allIngredients);\n\n      // Get pantry items to subtract\n      const pantryItems = await ctx.db.pantryItem.findMany({\n        where: { userId: ctx.session.user.id },\n      });\n\n      const pantryMap = new Map(\n        pantryItems.map((item) => [\n          item.ingredientId,\n          { quantity: item.quantity, unit: item.unit as NormalizedUnit },\n        ])\n      );\n\n      // Build shopping list with ingredient details\n      const shoppingListItems: ShoppingListItem[] = [];\n\n      for (const [ingredientId, aggData] of aggregated.entries()) {\n        const ingredient = await ctx.db.ingredient.findUnique({\n          where: { id: ingredientId },\n        });\n\n        if (!ingredient) continue;\n\n        // Subtract pantry items\n        let finalQuantity = aggData.quantity;\n        const pantryItem = pantryMap.get(ingredientId);\n        if (pantryItem && pantryItem.unit === aggData.unit) {\n          finalQuantity = Math.max(0, aggData.quantity - pantryItem.quantity);\n        }\n\n        if (finalQuantity > 0) {\n          shoppingListItems.push({\n            ingredientId: ingredient.id,\n            ingredientName: ingredient.name,\n            category: ingredient.category,\n            quantity: finalQuantity,\n            unit: aggData.unit,\n            formattedQuantity: formatQuantity(finalQuantity, aggData.unit),\n          });\n        }\n      }\n\n      // Group by category\n      const grouped = shoppingListItems.reduce(\n        (acc, item) => {\n          acc[item.category] ??= [];\n          acc[item.category]!.push(item);\n          return acc;\n        },\n        {} as Record<string, ShoppingListItem[]>\n      );\n\n      // Calculate price estimates per store\n      const priceBaselines = await ctx.db.priceBaseline.findMany();\n      const pricesByStore = new Map<string, number>();\n\n      for (const item of shoppingListItems) {\n        const categoryBaselines = priceBaselines.filter(\n          (pb) => pb.ingredientCategory === item.category\n        );\n\n        for (const baseline of categoryBaselines) {\n          // Convert to baseline unit for price calculation\n          if (baseline.unit !== item.unit) {\n            // Skip if units don't match (simplified - could add conversion)\n            continue;\n          }\n\n          const itemCost = item.quantity * baseline.pricePerUnit;\n          const currentTotal = pricesByStore.get(baseline.store) ?? 0;\n          pricesByStore.set(baseline.store, currentTotal + itemCost);\n        }\n      }\n\n      // Convert to array and sort by price\n      const storePrices: StorePrice[] = Array.from(pricesByStore.entries())\n        .map(([store, totalPrice]) => ({\n          store,\n          totalPrice: Math.round(totalPrice * 100) / 100, // Round to 2 decimals\n        }))\n        .sort((a, b) => a.totalPrice - b.totalPrice);\n\n      const cheapestStore = storePrices[0];\n\n      return {\n        mealPlanId: input.mealPlanId,\n        items: shoppingListItems,\n        grouped,\n        storePrices,\n        cheapestStore,\n        totalItems: shoppingListItems.length,\n      };\n    }),\n\n  // Export shopping list as CSV\n  exportCSV: protectedProcedure\n    .input(z.object({ mealPlanId: z.string() }))\n    .query(async ({ ctx, input }) => {\n      // Get shopping list data\n      const shoppingList = await ctx.db.mealPlan.findUnique({\n        where: { id: input.mealPlanId },\n        include: {\n          items: {\n            include: {\n              recipe: {\n                include: {\n                  ingredients: {\n                    include: {\n                      ingredient: true,\n                    },\n                  },\n                },\n              },\n            },\n          },\n        },\n      });\n\n      if (!shoppingList || shoppingList.userId !== ctx.session.user.id) {\n        throw new Error('Meal plan not found or access denied');\n      }\n\n      // Collect and aggregate ingredients\n      const allIngredients: Array<{\n        ingredientId: string;\n        quantity: number;\n        unit: string;\n      }> = [];\n\n      for (const item of shoppingList.items) {\n        const servingMultiplier = item.servings / item.recipe.servingsDefault;\n\n        for (const recipeIng of item.recipe.ingredients) {\n          allIngredients.push({\n            ingredientId: recipeIng.ingredientId,\n            quantity: recipeIng.quantity * servingMultiplier,\n            unit: recipeIng.unit,\n          });\n        }\n      }\n\n      const aggregated = aggregateIngredients(allIngredients);\n\n      // Build CSV content\n      let csv = 'Category,Ingredient,Quantity,Unit\\n';\n\n      for (const [ingredientId, aggData] of aggregated.entries()) {\n        const ingredient = await ctx.db.ingredient.findUnique({\n          where: { id: ingredientId },\n        });\n\n        if (!ingredient) continue;\n\n        csv += `${ingredient.category},${ingredient.name},${aggData.quantity},${aggData.unit}\\n`;\n      }\n\n      return { csv };\n    }),\n});\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1026, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/meal-planner-demo/meal-planner-demo/apps/web/src/server/api/root.ts"],"sourcesContent":["import { postRouter } from '~/server/api/routers/post';\nimport { preferencesRouter } from '~/server/api/routers/preferences';\nimport { mealPlanRouter } from '~/server/api/routers/mealPlan';\nimport { shoppingListRouter } from '~/server/api/routers/shoppingList';\nimport { createCallerFactory, createTRPCRouter } from '~/server/api/trpc';\n\n/**\n * This is the primary router for your server.\n *\n * All routers added in /api/routers should be manually added here.\n */\nexport const appRouter = createTRPCRouter({\n  post: postRouter,\n  preferences: preferencesRouter,\n  mealPlan: mealPlanRouter,\n  shoppingList: shoppingListRouter,\n});\n\n// export type definition of API\nexport type AppRouter = typeof appRouter;\n\n/**\n * Create a server-side caller for the tRPC API.\n * @example\n * const trpc = createCaller(createContext);\n * const res = await trpc.post.all();\n *       ^? Post[]\n */\nexport const createCaller = createCallerFactory(appRouter);\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAOO,MAAM,YAAY,IAAA,iKAAgB,EAAC;IACxC,MAAM,sKAAU;IAChB,aAAa,oLAAiB;IAC9B,UAAU,8KAAc;IACxB,cAAc,sLAAkB;AAClC;AAYO,MAAM,eAAe,IAAA,oKAAmB,EAAC","debugId":null}},
    {"offset": {"line": 1053, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/meal-planner-demo/meal-planner-demo/apps/web/src/app/api/trpc/%5Btrpc%5D/route.ts"],"sourcesContent":["import { fetchRequestHandler } from '@trpc/server/adapters/fetch';\nimport { type NextRequest } from 'next/server';\n\nimport { env } from '~/env';\nimport { appRouter } from '~/server/api/root';\nimport { createTRPCContext } from '~/server/api/trpc';\n\n/**\n * This wraps the `createTRPCContext` helper and provides the required context for the tRPC API when\n * handling a HTTP request (e.g. when you make requests from Client Components).\n */\nconst createContext = async (req: NextRequest) => {\n  return createTRPCContext({\n    headers: req.headers,\n  });\n};\n\nconst handler = (req: NextRequest) =>\n  fetchRequestHandler({\n    endpoint: '/api/trpc',\n    req,\n    router: appRouter,\n    createContext: () => createContext(req),\n    onError:\n      env.NODE_ENV === 'development'\n        ? ({ path, error }) => {\n            console.error(`‚ùå tRPC failed on ${path ?? '<no-path>'}: ${error.message}`);\n          }\n        : undefined,\n  });\n\nexport { handler as GET, handler as POST };\n"],"names":[],"mappings":";;;;;;AAAA;AAGA;AACA;AACA;;;;;AAEA;;;CAGC,GACD,MAAM,gBAAgB,OAAO;IAC3B,OAAO,IAAA,kKAAiB,EAAC;QACvB,SAAS,IAAI,OAAO;IACtB;AACF;AAEA,MAAM,UAAU,CAAC,MACf,IAAA,wRAAmB,EAAC;QAClB,UAAU;QACV;QACA,QAAQ,0JAAS;QACjB,eAAe,IAAM,cAAc;QACnC,SACE,kIAAG,CAAC,QAAQ,KAAK,gBACb,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE;YACd,QAAQ,KAAK,CAAC,CAAC,iBAAiB,EAAE,QAAQ,YAAY,EAAE,EAAE,MAAM,OAAO,EAAE;QAC3E,IACA;IACR","debugId":null}}]
}